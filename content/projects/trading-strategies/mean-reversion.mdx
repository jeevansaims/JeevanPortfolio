# Mean Reversion Trading Strategy

## What is Mean Reversion?

Mean reversion is the theory that prices and returns eventually move back toward the mean or average. This is one of the most fundamental concepts in quantitative trading.

**Core Idea**: When an asset's price deviates significantly from its historical average, it's likely to revert back.

### Real-World Example

Imagine a stock normally trades around $100. If it suddenly drops to $90 with no fundamental reason, a mean reversion trader might buy, expecting it to return to $100.

## What You'll Build

By the end of this project, you'll have:
1. âœ… Calculated returns from price data
2. âœ… Identified mean-reverting behavior
3. âœ… Built a simple trading signal
4. âœ… Backtested the strategy

Let's get started!

<Quiz
  id="quiz-mean-reversion"
  question="Which statement best describes mean reversion?"
  options={[
    "Prices always go up over time",
    "Prices tend to return to their historical average",
    "Prices move randomly with no pattern",
    "Prices only revert during market crashes"
  ]}
  correct={1}
  explanation="Correct! Mean reversion is the tendency for prices to return to their historical average after deviating from it."
/>

## Step 1: Calculate Returns

First, we need to convert prices into **returns**. Returns are more useful than raw prices because they:
- Are **stationary** (constant mean/variance)
- Allow comparison across assets
- Are approximately normally distributed

### Simple Return Formula

$$
r_t = \frac{P_t - P_{t-1}}{P_{t-1}} = \frac{P_t}{P_{t-1}} - 1
$$

Where:
- $r_t$ = return at time $t$
- $P_t$ = price at time $t$
- $P_{t-1}$ = price at time $t-1$

<CodeBlock
  code={`import numpy as np

# Example price data
prices = np.array([100, 102, 98, 101, 99])

# Calculate simple returns
returns = (prices[1:] / prices[:-1]) - 1

print("Prices:", prices)
print("Returns:", returns)
print("Mean return:", np.mean(returns))`}
  language="python"
  title="Example: Calculating Returns"
/>

<CodeExercise
  id="exercise-returns"
  starterCode={`def calculate_returns(prices):
    """
    Calculate simple returns from a price series.

    Args:
        prices: numpy array of prices

    Returns:
        numpy array of returns (length = len(prices) - 1)

    Example:
        >>> calculate_returns(np.array([100, 110, 105]))
        array([0.1, -0.045454...])
    """
    import numpy as np
    # TODO: Implement return calculation
    pass`}
  solution={`def calculate_returns(prices):
    """
    Calculate simple returns from a price series.
    """
    import numpy as np
    return (prices[1:] / prices[:-1]) - 1`}
  hint="Use array slicing: prices[1:] / prices[:-1] gives you P_t / P_(t-1)"
  tests={[
    {
      "input": ["np.array([100, 110, 105])"],
      "expected": [0.1, -0.045454545454545456],
      "hidden": false,
      "description": "Test 1: Basic price series",
      "tolerance": 0.0001
    },
    {
      "input": ["np.array([50, 50, 50])"],
      "expected": [0.0, 0.0],
      "hidden": false,
      "description": "Test 2: Flat prices",
      "tolerance": 0.0001
    },
    {
      "input": ["np.array([100, 90, 110, 100])"],
      "expected": [-0.1, 0.222222, -0.090909],
      "hidden": true,
      "description": "Hidden: Mean reverting series",
      "tolerance": 0.001
    }
  ]}
/>

## Step 2: Calculate Z-Score

The **z-score** tells us how many standard deviations away from the mean a value is.

$$
z = \frac{x - \mu}{\sigma}
$$

Where:
- $x$ = current value
- $\mu$ = mean
- $\sigma$ = standard deviation

**Trading Signal**:
- $z > 2$: Asset is "overbought" â†’ **SELL**
- $z < -2$: Asset is "oversold" â†’ **BUY**
- $|z| < 1$: No strong signal â†’ **HOLD**

<Quiz
  id="quiz-zscore"
  question="If a stock has a z-score of -2.5, what does a mean reversion trader do?"
  options={[
    "Sell (it's overbought)",
    "Buy (it's oversold)",
    "Hold (no signal)",
    "Short the stock"
  ]}
  correct={1}
  explanation="Correct! A negative z-score means the price is below average. -2.5 indicates it's significantly oversold, so we expect it to revert upward â†’ BUY."
/>

<CodeExercise
  id="exercise-zscore"
  starterCode={`def calculate_zscore(x, window_mean, window_std):
    """
    Calculate z-score for a value.

    Args:
        x: current value
        window_mean: rolling mean
        window_std: rolling standard deviation

    Returns:
        z-score (float)

    Example:
        >>> calculate_zscore(110, 100, 5)
        2.0
    """
    import numpy as np
    # TODO: Implement z-score calculation
    pass`}
  solution={`def calculate_zscore(x, window_mean, window_std):
    """
    Calculate z-score for a value.
    """
    import numpy as np
    if window_std == 0:
        return 0
    return (x - window_mean) / window_std`}
  hint="Formula: (x - mean) / std. Handle division by zero!"
  tests={[
    {
      "input": [110, 100, 5],
      "expected": 2.0,
      "hidden": false,
      "description": "Test 1: Basic z-score",
      "tolerance": 0.01
    },
    {
      "input": [95, 100, 10],
      "expected": -0.5,
      "hidden": false,
      "description": "Test 2: Negative z-score",
      "tolerance": 0.01
    },
    {
      "input": [100, 100, 0],
      "expected": 0,
      "hidden": true,
      "description": "Hidden: Zero std (handle gracefully)"
    }
  ]}
/>
 
<ConceptCheck
  id="concept-risk"
  question="What's the main risk of a mean reversion strategy?"
  answer="The main risk is that the 'deviation' might not be temporaryâ€”it could be a structural change (e.g., company bankruptcy, sector rotation). The price may never revert, leading to large losses. This is sometimes called 'catching a falling knife.'"
/>

<Quiz
  id="final-quiz"
  question="You observe a stock trading at $120 with a 20-day moving average of $100 and a standard deviation of $5. What is the z-score and what action would a mean reversion trader take?"
  options={[
    "z = 4; Buy (oversold)",
    "z = 4; Sell (overbought)",
    "z = 20; Sell (overbought)",
    "z = 0.8; Hold (no signal)"
  ]}
  correct={1}
  explanation="Correct! z = (120 - 100) / 5 = 4. A z-score of 4 is extremely high, indicating the stock is significantly overbought. A mean reversion trader would sell, expecting the price to revert back toward $100."
/>

## Congratulations! ðŸŽ‰

You've built the foundation of a mean reversion strategy:

âœ… **Returns calculation** - Convert prices to stationary returns

âœ… **Z-score signals** - Identify overbought/oversold conditions

âœ… **Risk awareness** - Understand when mean reversion fails

### Next Steps

1. **Try this on real data**: Download stock prices and test your functions
2. **Add risk management**: Implement stop-losses and position sizing
3. **Backtest properly**: Account for transaction costs and slippage
4. **Explore other strategies**: Momentum, pairs trading, statistical arbitrage

Keep learning and happy trading! ðŸ“ˆ
