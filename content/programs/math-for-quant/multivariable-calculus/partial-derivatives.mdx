# Partial Derivatives

## 1. Motivation: Why We Need Partial Derivatives

In Lesson 1, we established that quantitative finance lives in high dimensions. Option prices depend on $(S, \sigma, r, T)$. Portfolio risk depends on multiple weights. Factor models depend on exposures.

Now comes the critical question: **How does the output change when only ONE variable changes?**

### Key Questions in Finance

**Option Delta**

When the stock price $S$ increases by \$1, how much does the option price $C$ change?

This is **not** a hypothetical question, it's the foundation of hedging. Delta-neutral portfolios rely on knowing exactly how $C$ responds to $S$

**Vega**

When volatility $\sigma$ increases by 1%, how much does the option price change?

Traders care deeply about volatility exposure. Vega tells them their sensitivity.

**Portfolio Sensitivity**

For a portfolio $V = w_1 S_1 + w_2 S_2 + \cdots + w_n S_n$, how much does $V$ change when asset $i$'s price changes?

**The tool for answering these questions: partial derivatives.**

### The Core Idea

For a function $f(x, y)$:

- The **partial derivative** $\frac{\partial f}{\partial x}$ measures the rate of change of $f$ **with respect to $x$ alone**, holding $y$ constant.

- Similarly, $\frac{\partial f}{\partial y}$ measures change with respect to $y$ alone, holding $x$ constant.

**Think of it as:** freeze all variables except one, then take the ordinary derivative with respect to that variable.

This is how we isolate individual sensitivities in multivariable systems.

---

## 2. Definition of Partial Derivatives

For a function $f(x, y)$, the **partial derivative with respect to $x$** at point $(x_0, y_0)$ is:

$$
\frac{\partial f}{\partial x}(x_0, y_0) = \lim_{h \to 0} \frac{f(x_0 + h, y_0) - f(x_0, y_0)}{h}
$$

**Key:** Notice $y_0$ is **fixed**. We only vary $x$.

Similarly, the **partial derivative with respect to $y$** is:

$$
\frac{\partial f}{\partial y}(x_0, y_0) = \lim_{h \to 0} \frac{f(x_0, y_0 + h) - f(x_0, y_0)}{h}
$$

Here $x_0$ is fixed, and we only vary $y$.

### Notation

Partial derivatives have multiple notations:

$$
\frac{\partial f}{\partial x} = f_x = D_1 f = \partial_x f
$$

$$
\frac{\partial f}{\partial y} = f_y = D_2 f = \partial_y f
$$

**Most common in finance:** $\frac{\partial f}{\partial x}$ and $f_x$.

### Intuition

If you know single-variable calculus, you already know how to compute partial derivatives:

**Rule:** Treat all other variables as constants, then differentiate normally.

That's it. Partial derivatives are just ordinary derivatives in disguise.

---

## 3. Geometric Interpretation

For a function $z = f(x, y)$, the surface lives in 3D space.

**Partial derivative $\frac{\partial f}{\partial x}$:**

- Imagine slicing the surface with a plane parallel to the $xz$-plane (holding $y$ constant).
- The cross-section is a curve.
- $\frac{\partial f}{\partial x}$ is the **slope** of this curve.

**Partial derivative $\frac{\partial f}{\partial y}$:**

- Slice the surface with a plane parallel to the $yz$-plane (holding $x$ constant).
- $\frac{\partial f}{\partial y}$ is the slope of that curve.

### Analogy: Walking on a Hill

Imagine standing on a hillside (the surface $z = f(x, y)$):

- **Walking east–west** (changing $x$, holding $y$ fixed): The slope you experience is $\frac{\partial f}{\partial x}$.
- **Walking north–south** (changing $y$, holding $x$ fixed): The slope you experience is $\frac{\partial f}{\partial y}$.

The surface may slope steeply in one direction and gently in another. Partial derivatives capture these **directional slopes**.

---

## 4. Computing Partial Derivatives (Rules & Examples)

The key rule: **hold all other variables constant, then differentiate**.

### Example 1: Polynomial

$$
f(x, y) = x^2 y + 3xy^2
$$

**Compute $f_x$:**

Treat $y$ as a constant:

$$
f_x = \frac{\partial}{\partial x}(x^2 y + 3xy^2) = 2xy + 3y^2
$$

**Compute $f_y$:**

Treat $x$ as a constant:

$$
f_y = \frac{\partial}{\partial y}(x^2 y + 3xy^2) = x^2 + 6xy
$$

### Example 2: Exponential

$$
f(x, y) = e^{xy}
$$

**Compute $f_x$:**

Use the chain rule. Let $u = xy$, so $f = e^u$:

$$
f_x = e^{xy} \cdot \frac{\partial}{\partial x}(xy) = e^{xy} \cdot y = y e^{xy}
$$

**Compute $f_y$:**

$$
f_y = e^{xy} \cdot \frac{\partial}{\partial y}(xy) = e^{xy} \cdot x = x e^{xy}
$$

### Example 3: Logarithm

$$
f(x, y) = \ln(x^2 + y)
$$

**Compute $f_x$:**

$$
f_x = \frac{1}{x^2 + y} \cdot \frac{\partial}{\partial x}(x^2 + y) = \frac{2x}{x^2 + y}
$$

**Compute $f_y$:**

$$
f_y = \frac{1}{x^2 + y} \cdot \frac{\partial}{\partial y}(x^2 + y) = \frac{1}{x^2 + y}
$$

### Example 4: Ratio

$$
f(x, y) = \frac{x}{y}
$$

**Compute $f_x$:**

Treat $y$ as constant:

$$
f_x = \frac{1}{y}
$$

**Compute $f_y$:**

Use the quotient rule (or rewrite as $f = xy^{-1}$):

$$
f_y = x \cdot (-1) y^{-2} = -\frac{x}{y^2}
$$

### Key Takeaway

**Partial derivatives are computed exactly like ordinary derivatives, just freeze the other variables.**

---

## 5. Higher-Order Partial Derivatives

Just as we have second derivatives in single-variable calculus, we have **second-order partial derivatives** for multivariable functions.

### Notation

For $f(x, y)$:

$$
f_{xx} = \frac{\partial^2 f}{\partial x^2} = \frac{\partial}{\partial x}\left(\frac{\partial f}{\partial x}\right)
$$

$$
f_{yy} = \frac{\partial^2 f}{\partial y^2} = \frac{\partial}{\partial y}\left(\frac{\partial f}{\partial y}\right)
$$

**Mixed partial derivatives:**

$$
f_{xy} = \frac{\partial^2 f}{\partial y \partial x} = \frac{\partial}{\partial y}\left(\frac{\partial f}{\partial x}\right)
$$

$$
f_{yx} = \frac{\partial^2 f}{\partial x \partial y} = \frac{\partial}{\partial x}\left(\frac{\partial f}{\partial y}\right)
$$

### Clairaut's Theorem (Symmetry of Mixed Partials)

For **nice** functions (continuous second derivatives), the order doesn't matter:

$$
f_{xy} = f_{yx}
$$

This is **extremely useful**, you can compute mixed partials in whichever order is easier.

### Example: Second-Order Derivatives

$$
f(x, y) = x^3 y^2
$$

**First-order:**

$$
f_x = 3x^2 y^2, \quad f_y = 2x^3 y
$$

**Second-order:**

$$
f_{xx} = 6x y^2, \quad f_{yy} = 2x^3
$$

**Mixed:**

$$
f_{xy} = \frac{\partial}{\partial y}(3x^2 y^2) = 6x^2 y
$$

$$
f_{yx} = \frac{\partial}{\partial x}(2x^3 y) = 6x^2 y
$$

Notice: $f_{xy} = f_{yx}$ ✓

### Why Second-Order Derivatives Matter

- **$f_{xx}$ and $f_{yy}$** measure **curvature** in the $x$ and $y$ directions (convexity/concavity).
- **$f_{xy}$** measures how the slope in one direction changes as you move in the other direction (interaction effects).
- Later in Lesson 6, we'll collect these into the **Hessian matrix**, which governs optimization and risk models.

For now, just know: second-order partials capture curvature and interaction.

---

## 6. Quant Finance Examples

Partial derivatives are the **foundation of quantitative finance**. Let's see how.

### A. Delta: Sensitivity to Stock Price

For a call option with price $C(S, \sigma, r, T)$, the **delta** is:

$$
\Delta = \frac{\partial C}{\partial S}
$$

**Interpretation:**

- Delta measures how much the option price changes when the stock price changes by a small amount.
- If $\Delta = 0.6$, then a \$1 increase in $S$ increases $C$ by approximately \$0.60.

**Why it matters:**

- **Hedging:** To delta-hedge, you hold $-\Delta$ shares of stock for each option. This makes your portfolio insensitive to small stock price moves.
- **Risk management:** Delta tells you your directional exposure.

For European calls, the Black-Scholes formula gives:

$$
\Delta = N(d_1)
$$

where $N(\cdot)$ is the cumulative standard normal distribution and $d_1$ is a function of $S, \sigma, r, T$.

**Key point:** Delta is a **partial derivative**. You're measuring sensitivity to $S$ alone.

### B. Vega: Sensitivity to Volatility

Vega measures sensitivity to volatility $\sigma$:

$$
\text{Vega} = \frac{\partial C}{\partial \sigma}
$$

**Interpretation:**

- Vega tells you how much the option price changes when implied volatility changes.
- High vega = high exposure to volatility risk.

**Why it matters:**

- **Volatility trading:** Traders buy/sell options based on vega exposure.
- **Vol hedging:** You can hedge vega by trading options with different maturities or strikes.

For Black-Scholes:

$$
\text{Vega} = S \sqrt{T} \cdot n(d_1)
$$

where $n(\cdot)$ is the standard normal PDF.

**Key point:** Vega isolates sensitivity to $\sigma$, holding $S, r, T$ constant.

### C. Other Greeks

The "Greeks" are partial derivatives:

- **Gamma** $= \frac{\partial^2 C}{\partial S^2}$ (second derivative w.r.t. stock price, curvature of delta)
- **Theta** $= \frac{\partial C}{\partial T}$ (sensitivity to time decay)
- **Rho** $= \frac{\partial C}{\partial r}$ (sensitivity to interest rates)

All of these measure **isolated sensitivities** to individual inputs. This is the power of partial derivatives.

### D. Portfolio Sensitivity

For a portfolio:

$$
V(S_1, S_2, \ldots, S_n) = w_1 S_1 + w_2 S_2 + \cdots + w_n S_n
$$

The sensitivity to asset $i$'s price is:

$$
\frac{\partial V}{\partial S_i} = w_i
$$

**Interpretation:**

- If you hold 100 shares of asset 1, then $\frac{\partial V}{\partial S_1} = 100$.
- A \$1 increase in $S_1$ increases your portfolio value by \$100.

Simple, but this is the **foundation of risk attribution**, understanding which positions drive your portfolio's movements.

---

## 7. Partial Derivatives for Functions with More Variables

The definition extends naturally to functions of $n$ variables.

For $f(x_1, x_2, \ldots, x_n)$, the partial derivative with respect to $x_i$ is:

$$
\frac{\partial f}{\partial x_i} = \lim_{h \to 0} \frac{f(x_1, \ldots, x_i + h, \ldots, x_n) - f(x_1, \ldots, x_i, \ldots, x_n)}{h}
$$

**In practice:** Hold all variables except $x_i$ constant, then differentiate.

### Example: Option Pricing Surface

For $C = f(S, \sigma, r, T)$:

$$
\frac{\partial C}{\partial S} = \Delta \quad (\text{delta})
$$

$$
\frac{\partial C}{\partial \sigma} = \text{Vega}
$$

$$
\frac{\partial C}{\partial r} = \text{Rho}
$$

$$
\frac{\partial C}{\partial T} = \Theta \quad (\text{theta})
$$

Each partial derivative isolates one dimension of sensitivity.

### Example: Portfolio Variance

For a 2-asset portfolio:

$$
\sigma^2(w_1, w_2) = w_1^2 \sigma_1^2 + 2\rho \sigma_1 \sigma_2 w_1 w_2 + w_2^2 \sigma_2^2
$$

**Compute $\frac{\partial \sigma^2}{\partial w_1}$:**

$$
\frac{\partial \sigma^2}{\partial w_1} = 2w_1 \sigma_1^2 + 2\rho \sigma_1 \sigma_2 w_2
$$

**Interpretation:** This tells you how risk changes as you adjust the weight in asset 1.

Later (Lesson 5), we'll use this to **minimize portfolio variance** by setting partial derivatives to zero.

---

## 8. Common Mistakes

### Mistake 1: Forgetting to Hold Other Variables Constant

**Wrong:**

For $f(x, y) = x^2 y$, treating $y$ as a function of $x$ and using the product rule:

$$
\frac{d}{dx}(x^2 y) = 2xy + x^2 \frac{dy}{dx} \quad \text{(WRONG for partial derivatives)}
$$

**Right:**

Treat $y$ as a **constant**:

$$
\frac{\partial f}{\partial x} = 2xy
$$

### Mistake 2: Confusing Partial Derivatives with Total Derivatives

Partial derivatives measure change in **one variable alone**.

Total derivatives (which we'll cover later with the chain rule) account for **all variables changing simultaneously**.

Don't mix them up.

### Mistake 3: Differentiating with Respect to the Wrong Variable

For $f(x, y) = x^3 + y^2$:

$$
\frac{\partial f}{\partial x} = 3x^2 \quad (\text{not } 2y)
$$

$$
\frac{\partial f}{\partial y} = 2y \quad (\text{not } 3x^2)
$$

Always double-check which variable you're differentiating with respect to.

### Mistake 4: Confusing Partial Derivatives with Gradients

A partial derivative $\frac{\partial f}{\partial x}$ is a **scalar** (a number).

The **gradient** $\nabla f$ (covered in Lesson 3) is a **vector** containing all partial derivatives:

$$
\nabla f = \begin{pmatrix} \frac{\partial f}{\partial x} \\ \frac{\partial f}{\partial y} \end{pmatrix}
$$

Don't conflate the two.

---

## 9. Summary

- **Partial derivatives** measure how a function changes with respect to **one variable** while holding others constant.

- **Notation:** $\frac{\partial f}{\partial x}$, $f_x$, $D_1 f$.

- **How to compute:** Treat all other variables as constants, then differentiate normally.

- **Geometric interpretation:** Partial derivatives are slopes of cross-sections of the surface $z = f(x, y)$.

- **Second-order partials** capture curvature and interaction effects: $f_{xx}, f_{yy}, f_{xy}$.

- **Clairaut's theorem:** For nice functions, $f_{xy} = f_{yx}$.

- **In quantitative finance, partial derivatives are everywhere:**
  - **Delta** $= \frac{\partial C}{\partial S}$ (stock price sensitivity)
  - **Vega** $= \frac{\partial C}{\partial \sigma}$ (volatility sensitivity)
  - **Gamma, Theta, Rho** (other Greeks)
  - **Portfolio sensitivities** $\frac{\partial V}{\partial S_i}$

- **Partial derivatives isolate individual sensitivities**, critical for hedging, risk management, and optimization.

**Key takeaway:** Partial derivatives are the foundation of sensitivity analysis in quantitative finance. Mastering them unlocks Greeks, risk attribution, and optimization.

---

## 10. Next Steps

Now that we can measure change in individual directions, we need to combine these into a **vector** that points in the direction of steepest ascent.

**Next lesson: Gradients & Directional Derivatives**

You'll learn:
- How to assemble partial derivatives into the **gradient vector** $\nabla f$
- What the gradient means geometrically (direction of steepest ascent)
- How to compute the **directional derivative** in any direction
- Why $\nabla f$ is perpendicular to level curves
- Applications: gradient descent, portfolio optimization, risk minimization

The gradient is the workhorse of optimization. Let's build it.
